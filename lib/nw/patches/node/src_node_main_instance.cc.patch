diff -r -u --color up/node/src/node_main_instance.cc nw/node/src/node_main_instance.cc
--- up/node/src/node_main_instance.cc	2023-02-14 22:09:05.000000000 +0000
+++ nw/node/src/node_main_instance.cc	2023-02-19 17:37:33.295599279 +0000
@@ -29,6 +29,8 @@
 using v8::Local;
 using v8::Locker;
 
+extern bool node_is_nwjs;
+
 NodeMainInstance::NodeMainInstance(Isolate* isolate,
                                    uv_loop_t* event_loop,
                                    MultiIsolatePlatform* platform,
@@ -70,6 +72,8 @@
       isolate_data_(),
       isolate_params_(std::make_unique<Isolate::CreateParams>()),
       snapshot_data_(snapshot_data) {
+  if (node_is_nwjs)
+    array_buffer_allocator_.reset();
   isolate_params_->array_buffer_allocator = array_buffer_allocator_.get();
   if (snapshot_data != nullptr) {
     SnapshotBuilder::InitializeIsolateParams(snapshot_data,
@@ -162,7 +166,7 @@
 #ifdef NODE_V8_SHARED_RO_HEAP
     // TODO(addaleax): Do this as part of creating the Environment
     // once we store the SnapshotData* itself on IsolateData.
-    env->builtin_loader()->RefreshCodeCache(snapshot_data_->code_cache);
+    //env->builtin_loader()->RefreshCodeCache(snapshot_data_->code_cache);
 #endif
     context = Context::FromSnapshot(isolate_,
                                     SnapshotData::kNodeMainContextIndex,
