diff -r -u --color up/chromium/extensions/browser/extension_web_contents_observer.cc nw/chromium/extensions/browser/extension_web_contents_observer.cc
--- up/chromium/extensions/browser/extension_web_contents_observer.cc	2023-02-15 18:46:36.000000000 +0000
+++ nw/chromium/extensions/browser/extension_web_contents_observer.cc	2023-02-19 17:36:36.831467491 +0000
@@ -123,20 +123,22 @@
       GetExtensionFromFrame(render_frame_host, false);
   // This observer is attached to every WebContents, so we are also notified of
   // frames that are not in an extension process.
-  if (!frame_extension)
-    return;
 
   // |render_frame_host->GetProcess()| is an extension process. Grant permission
   // to request pages from the extension's origin.
   content::ChildProcessSecurityPolicy* security_policy =
       content::ChildProcessSecurityPolicy::GetInstance();
   int process_id = render_frame_host->GetProcess()->GetID();
-  security_policy->GrantRequestOrigin(process_id, frame_extension->origin());
+  security_policy->GrantRequestScheme(
+                                      process_id, extensions::kExtensionScheme);
 
   // Notify the render frame of the view type.
   GetLocalFrame(render_frame_host)
       ->NotifyRenderViewType(GetViewType(web_contents()));
 
+  //moved here for NWJS#5181: getall() with remote window
+  if (!frame_extension)
+    return;
   ProcessManager::Get(browser_context_)
       ->RegisterRenderFrameHost(web_contents(), render_frame_host,
                                 frame_extension);
@@ -177,6 +179,12 @@
         browser_context_);
   }
 
+  if (type == Manifest::TYPE_NWJS_APP) {
+      content::ChildProcessSecurityPolicy::GetInstance()->GrantRequestScheme(
+          render_frame_host->GetProcess()->GetID(), url::kFileScheme);
+      content::ChildProcessSecurityPolicy::GetInstance()->GrantAll(
+          render_frame_host->GetProcess()->GetID());
+  }
   // Tells the new frame that it's hosted in an extension process.
   //
   // This will often be a redundant IPC, because activating extensions happens
